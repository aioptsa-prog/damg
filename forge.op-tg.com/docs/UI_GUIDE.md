# دليل واجهة المستخدم (UI Guide)

هذا الدليل يشرح مبادئ التصميم والتفاعل في الواجهة، وكيفية استخدام المكوّنات الشائعة، مع تركيز على العربية وRTL وإمكانية الوصول.

## الأساسيات
- اتجاه RTL افتراضيًا، خط Tajawal، ألوان قابلة للتهيئة عبر CSS variables.
- الوضعان الفاتح/الداكن مع زر تبديل ووضع نظام تلقائي؛ يُحفظ الاختيار في localStorage.
- روابط الوصول السريع: رابط "تخطي إلى المحتوى" وخيارات ARIA في الأزرار والأيقونات.

## الجداول (DataTables)
- جميع الجداول التي تحمل data-dt="1" تُفعَّل تلقائيًا: صفحة 25، ترتيب افتراضي فارغ (محافظ)، Responsive.
- لغة الواجهة عبر CDN (Arabic i18n). في البيئات المقيّدة يمكن توفير نسخة محلية لاحقًا.
- مدير الأعمدة: إظهار/إخفاء أعمدة + Presets:
  - Essentials: أعمدة مطلوبة فقط (حسب data-required)
  - Detailed: كل الأعمدة
- كثافة العرض: زر يبدّل Table-Compact ويُحفظ لكل جدول (localStorage).

## حفظ الفلاتر
- علم الميزة: `ui_persist_filters` (يتم ضبطه في الإعدادات أو عبر أداة feature_flags).
- النماذج التي تحمل data-persist تحفظ وتسترجع القيم عند كون النموذج فارغًا؛ زر data-persist-reset لمسح المحفوظ.

## الخرائط (Leaflet)
- تحميل محلي أولًا من `assets/vendor/leaflet/*` مع بدائل CDN تلقائية.
- حماية CSS داخل `.leaflet-container` لتعطيل `max-width` على الصور والبلاطات.
- طبقة بلاطات مرنة بمصادر متعددة وفواصل تلقائية؛ سطر حالة أسفل الخريطة يوضح المصدر.
- إعداد إداري اختياري: `tile_sources_json` لتحديد مصادر مسموح بها داخل بيئة المؤسسة.

## المكوّنات
- Collapsible (details/summary) للبيانات التفصيلية وكتل JSON مع زر نسخ.
- Toasts خفيفة عبر `window.showToast(msg, type)`.
- زر العودة للأعلى (FAB) يظهر بعد التمرير.

## إمكانية الوصول (A11y)
- تركيز مرئي واضح باستخدام :focus-visible.
- أيقونات لها aria-label عند الحاجة.
- ألوان بتباين محسّن.

## نصائح للتطوير
- عند إضافة جدول جديد: ضع data-dt="1"، حدّد أعمدة مطلوبة عبر data-required لتعمل Preset Essentials.
- عند إضافة نموذج: أضف data-persist لاستخدام حفظ الفلاتر.
- عند إضافة خريطة: لا تعتمد على DOMContentLoaded فقط؛ تحقّق من `window.L` أو استخدم نفس منطق التحميل المرن.
